<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spion Spiel Lobby</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f2f2f2; }
    input, button, select { margin: 10px; padding: 10px; font-size: 1em; }
    #lobby, #game { display: none; }
  </style>
</head>
<body>

<h1>🕵️ Spion Spiel Online</h1>

<div id="start">
  <input type="text" id="playerName" placeholder="Dein Name">
  <br>
  <button onclick="createLobby()">Lobby erstellen</button>
  <br>
  <input type="text" id="lobbyCodeInput" placeholder="Lobby-Code eingeben">
  <button onclick="joinLobby()">Lobby beitreten</button>
</div>

<div id="lobby">
  <h2>Lobby Code: <span id="lobbyCode"></span></h2>
  <div id="players"></div>
  <br>
  <select id="categorySelect">
    <option value="Geografie">🏙️ Geografie</option>
    <option value="Geschichte">📦 Geschichte</option>
    <option value="Anime">👒 Anime</option>
    <option value="Filme und Serien">🎬 Filme und Serien</option>
    <option value="Bekannte Persönlichkeiten">🌟 Persönlichkeiten</option>
  </select>
  <br>
  <input type="number" id="spyCount" placeholder="Anzahl Spione" min="1">
  <br>
  <button onclick="startGame()">Spiel starten</button>
</div>

<div id="game">
  <h2 id="gameInfo"></h2>
</div>

<script>
const socket = io('https://dein-backend-url.onrender.com'); // <<< HIER deinen echten Backend-Link einfügen

let currentLobby = '';

function createLobby() {
  const name = document.getElementById('playerName').value;
  if (!name) return alert('Bitte Namen eingeben!');
  socket.emit('createLobby', { playerName: name }, ({ lobbyCode }) => {
    currentLobby = lobbyCode;
    document.getElementById('start').style.display = 'none';
    document.getElementById('lobby').style.display = 'block';
    document.getElementById('lobbyCode').innerText = lobbyCode;
  });
}

function joinLobby() {
  const name = document.getElementById('playerName').value;
  const lobbyCode = document.getElementById('lobbyCodeInput').value.toUpperCase();
  if (!name || !lobbyCode) return alert('Bitte Name und Lobby-Code eingeben!');
  socket.emit('joinLobby', { lobbyCode, playerName: name }, (response) => {
    if (response.error) return alert(response.error);
    currentLobby = lobbyCode;
    document.getElementById('start').style.display = 'none';
    document.getElementById('lobby').style.display = 'block';
    document.getElementById('lobbyCode').innerText = lobbyCode;
  });
}

function startGame() {
  const spyCount = parseInt(document.getElementById('spyCount').value);
  const category = document.getElementById('categorySelect').value;
  if (!spyCount || spyCount < 1) return alert('Anzahl der Spione angeben!');
  socket.emit('startGame', { lobbyCode: currentLobby, spyCount, category });
}

socket.on('updatePlayers', (players) => {
  const playersDiv = document.getElementById('players');
  playersDiv.innerHTML = '<h3>Spieler:</h3>';
  players.forEach(p => {
    const div = document.createElement('div');
    div.innerText = p.name;
    playersDiv.appendChild(div);
  });
});

socket.on('gameData', ({ category, role }) => {
  document.getElementById('lobby').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  if (role === 'Spion') {
    document.getElementById('gameInfo').innerText = `Kategorie: ${category}\n🕵️ Du bist ein Spion!`;
  } else {
    document.getElementById('gameInfo').innerText = `Kategorie: ${category}\n🔑 Dein Wort: ${role}`;
  }
});
</script>

</body>
</html>
